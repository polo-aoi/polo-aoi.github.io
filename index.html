<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ポロ蒼 | Polo Aoi</title>
    <link rel="icon" href="images/avatar.jpg" type="image/jpeg">
    
    <style>
        /* --- 1. 全局配置 --- */
        :root {
            --primary: #0044cc;
            --bg-color: #ffffff;
            --text-main: #1a1a1a;
            --text-light: #888888;
            --line-color: #f5f5f5;
            --tag-bg: #f8f8f8;
            /* ⚡️ 修复4：水印颜色加深，从 0.03 改为 0.08，肉眼清晰可见 */
            --watermark-color: rgba(0, 0, 0, 0.08); 
        }

        /* 背景水印 */
        body::before {
            content: '无限进步';
            position: fixed;
            top: 25%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 15vw; 
            font-weight: 900;
            color: var(--watermark-color);
            pointer-events: none;
            z-index: -1;
            white-space: nowrap;
            font-family: "Songti SC", "Noto Serif SC", serif; 
            letter-spacing: 0;
        }

        body { margin: 0; padding: 0; background-color: var(--bg-color); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; color: var(--text-main); line-height: 1.8; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }

        /* --- 开屏动画 --- */
        .opening-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #fff;
            z-index: 9999;
            pointer-events: none;
            animation: fadeOutOverlay 0.8s ease-out 1.8s forwards;
        }

        @keyframes fadeOutOverlay { to { opacity: 0; visibility: hidden; } }

        .opening-wrapper {
            position: absolute;
            top: 25%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex; gap: 0; white-space: nowrap;
        }

        .opening-char {
            font-size: 15vw; font-weight: 900; color: #000;
            font-family: "Songti SC", "Noto Serif SC", serif;
            letter-spacing: 0; opacity: 0;
            animation: floatIn 0.6s cubic-bezier(0.22, 0.61, 0.36, 1) forwards, morphOnly 0.6s cubic-bezier(0.22, 0.61, 0.36, 1) 1.2s forwards;
        }
        
        .char-1 { animation-delay: 0.05s, 1.2s; }
        .char-2 { animation-delay: 0.1s, 1.2s; }
        .char-3 { animation-delay: 0.15s, 1.2s; }
        .char-4 { animation-delay: 0.2s, 1.2s; }

        @keyframes floatIn { 0% { opacity: 0; transform: translateY(50px) scale(0.85); } 100% { opacity: 1; transform: translateY(0) scale(0.85); } }
        @keyframes morphOnly { 0% { transform: translateY(0) scale(0.85); color: #000; } 100% { transform: translateY(0) scale(1); color: var(--watermark-color); } }

        /* --- 主内容包裹 --- */
        .main-content-wrapper {
            opacity: 0;
            animation: fadeInMain 1.0s ease-out 1.8s forwards;
        }
        @keyframes fadeInMain { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 头部区域 --- */
        .header { 
            padding-top: 55vh; 
            margin-bottom: 60px; 
            position: relative; 
        }
        
        .user-wrapper { max-width: 700px; margin: 0 auto; position: relative; padding: 0 20px; z-index: 10; }

        .user-card {
            background: #ffffff;
            box-shadow: 0 20px 60px rgba(0,0,0,0.04); 
            padding: 35px;
            border-radius: 24px;
            display: flex; align-items: center; gap: 35px;
            transition: transform 0.3s ease;
            position: relative; z-index: 2;
        }
        .user-card:hover { transform: translateY(-2px); }

        .avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; background-color: #f8f8f8; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .user-text { flex-grow: 1; }
        .user-name { font-size: 30px; font-weight: 900; color: #1a1a1a; letter-spacing: -0.5px; margin-bottom: 12px; line-height: 1; }
        .user-motto { font-family: "Songti SC", "Noto Serif SC", serif; font-size: 14px; color: #555; font-style: italic; letter-spacing: 0.5px; line-height: 1.5; border-left: 2px solid var(--primary); padding-left: 12px; }

        /* --- 容器 --- */
        .container { max-width: 700px; margin: 0 auto; padding: 0 20px; padding-bottom: 100px; position: relative; z-index: 2; background: transparent; }
        
        .toolbar-container { margin-bottom: 40px; position: relative; background: #fff; border-radius: 12px; }
        .search-row { display: flex; gap: 10px; align-items: center; }
        .search-wrapper { position: relative; flex-grow: 1; }
        .search-input { width: 100%; padding: 12px 20px 12px 45px; border: 1px solid var(--line-color); border-radius: 12px; background-color: #fff; font-size: 15px; color: #333; outline: none; transition: all 0.3s ease; box-sizing: border-box; -webkit-appearance: none; }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 4px 15px rgba(0, 68, 204, 0.05); }
        .search-icon { position: absolute; top: 50%; left: 18px; transform: translateY(-50%); width: 14px; height: 14px; border: 2px solid #ccc; border-radius: 50%; pointer-events: none; }
        .search-icon::after { content: ''; position: absolute; top: 10px; left: 10px; width: 4px; height: 2px; background-color: #ccc; transform: rotate(45deg); }
        .search-input:focus ~ .search-icon { border-color: var(--primary); }
        .search-input:focus ~ .search-icon::after { background-color: var(--primary); }

        .filter-btn { padding: 0 20px; height: 46px; border-radius: 12px; border: 1px solid var(--line-color); background-color: #fff; color: #555; font-size: 14px; font-weight: 600; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 6px; transition: all 0.2s ease; }
        .filter-btn:hover { background-color: #f9f9f9; border-color: #ddd; }
        .filter-btn svg { width: 16px; height: 16px; fill: currentColor; }
        .filter-btn.active { background-color: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 4px 12px rgba(0, 68, 204, 0.2); }

        .tag-panel { display: none; margin-top: 15px; background: #fff; border: 1px solid var(--line-color); border-radius: 16px; padding: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .tag-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag-option { padding: 6px 14px; border-radius: 8px; background-color: var(--tag-bg); color: #666; font-size: 13px; font-weight: 500; border: none; cursor: pointer; transition: all 0.2s; }
        .tag-option:hover { background-color: #eef2ff; color: var(--primary); }
        .tag-option.selected { background-color: var(--primary); color: #fff; }

        .post-card { background:#fff; margin-bottom: 40px; cursor: pointer; border-bottom: 1px solid var(--line-color); padding-bottom: 25px; transition: all 0.3s; }
        .post-card:hover { transform: translateY(-3px); }
        .card-header-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .post-meta { font-size: 13px; color: var(--text-light); font-family: Georgia, serif; font-style: italic; }
        .card-tag { font-size: 11px; color: var(--primary); background-color: rgba(0, 68, 204, 0.05); padding: 2px 8px; border-radius: 4px; font-weight: 600; letter-spacing: 0.5px; }
        .post-title { font-size: 22px; font-weight: 800; margin: 0 0 10px 0; line-height: 1.3; color: #1a1a1a; transition: color 0.2s;}
        .post-card:hover .post-title { color: var(--primary); }
        .post-excerpt { font-size: 15px; color: #555; line-height: 1.7; margin-bottom: 15px; } 
        .search-highlight { color: var(--primary); font-weight: bold; background: rgba(0, 68, 204, 0.05); padding: 0 2px; border-radius: 2px; }
        .post-cover-thumb { width: 100%; height: 240px; object-fit: cover; border-radius: 12px; margin-bottom: 18px; background-color: #f8f8f8; display: block; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .read-more-btn { color: var(--primary); font-size: 13px; font-weight: 700; letter-spacing: 0.5px; }
        
        /* --- 阅读器 (修复版) --- */
        #article-reader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 100; overflow-y: auto; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* ⚡️ 修复2：给导航栏增加超高 z-index，防止 H2 穿透 */
        .reader-nav { 
            max-width: 700px; margin: 0 auto; padding: 20px; 
            position: sticky; top: 0; 
            background: rgba(255,255,255,0.98); 
            border-bottom: 1px solid var(--line-color); 
            display: flex; justify-content: space-between; align-items: center; 
            backdrop-filter: blur(10px); 
            z-index: 1000; /* 关键：层级一定要比内容高 */
        }
        
        .back-btn { border: none; background: none; font-size: 16px; cursor: pointer; color: var(--text-main); display: flex; align-items: center; }
        .back-btn::before { content: '←'; margin-right: 8px; font-size: 20px; }
        
        /* 为了配合 sticky 导航，给内容顶部加点边距 */
        .reader-content { max-width: 680px; margin: 0 auto; padding: 40px 20px 100px; }
        
        .reader-content h1 { font-size: 32px; margin-bottom: 10px; line-height: 1.3; color: #1a1a1a; font-weight: 900; }
        .reader-content .meta { color: var(--text-light); font-size: 13px; margin-bottom: 40px; border-bottom: 1px solid var(--line-color); padding-bottom: 25px; }
        
        .reader-content h2 { 
            font-size: 22px; margin-top: 50px; margin-bottom: 20px; color: #1a1a1a; font-weight: 800; 
            position: relative; padding-left: 12px; z-index: 1; /* 确保不乱跑 */
        }
        .reader-content h2::before { 
            content: ''; position: absolute; left: 0; top: 4px; height: 24px; width: 4px; background: var(--primary); border-radius: 2px;
        }

        .reader-content p { font-size: 17px; line-height: 1.85; margin-bottom: 25px; color: #333; }
        .reader-content img { display: block; margin: 30px auto; max-width: 100%; border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
        .reader-content blockquote { border-left: 3px solid var(--primary); margin: 30px 0; padding: 20px 25px; background: #f8faff; color: #555; font-size: 16px; border-radius: 0 8px 8px 0; }
        .reader-content code { background: #f4f4f4; padding: 3px 6px; border-radius: 4px; font-family: "Menlo", "Consolas", monospace; color: #d63384; font-size: 0.9em; }

        @media screen and (max-width: 768px) {
            /* ⚡️ 修复1：手机端大幅减小顶部留白，解决割裂感 */
            /* 之前是 60vh，现在改为 45vh，拉近名片和水印的距离 */
            .header { padding-top: 45vh; margin-bottom: 30px; }
            
            .user-card { flex-direction: column; text-align: center; gap: 20px; padding: 30px 20px; align-items: center;}
            .container { padding: 0 15px 80px; }
            .reader-content img { max-height: 400px; }
            .user-motto { border-left: none; padding-left: 0; text-align: center; } 
        }
    </style>
</head>
<body>

    <div class="opening-overlay">
        <div class="opening-wrapper">
            <span class="opening-char char-1">无</span>
            <span class="opening-char char-2">限</span>
            <span class="opening-char char-3">进</span>
            <span class="opening-char char-4">步</span>
        </div>
    </div>

    <div class="main-content-wrapper">
        <div class="header">
            <div class="user-wrapper">
                <div class="user-card">
                    <img src="images/avatar.jpg" class="avatar" onerror="this.src='https://api.dicebear.com/7.x/notionists/svg?seed=Felix'">
                    <div class="user-text">
                        <div class="user-name">ポロ蒼</div>
                        <div class="user-motto">轮回非循环，乃螺旋；直面熵增，创生负熵。</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="toolbar-container">
                <div class="search-row">
                    <div class="search-wrapper">
                        <input type="text" id="searchInput" class="search-input" placeholder="Search..." oninput="handleSearch()">
                        <div class="search-icon"></div>
                    </div>
                    <button id="filterBtn" class="filter-btn" onclick="toggleTagPanel()">
                        <svg viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>
                        <span id="filterBtnText">Tags</span>
                    </button>
                </div>
                <div id="tagPanel" class="tag-panel">
                    <div id="tagGrid" class="tag-grid"></div>
                </div>
            </div>
            <div id="posts-container"></div>
        </div>
    </div>

    <div id="article-reader">
        <div class="reader-nav">
            <button class="back-btn" onclick="closeArticle()">Back to Home</button>
            <span style="font-weight:bold; color:var(--primary);">ポロ蒼</span>
        </div>
        <div class="reader-content" id="reader-body"></div>
    </div>

    <script>
       const blogData = [
           {
                id: "post-13",
                title: "双膜法（UF+RO）水处理系统全流程技术手册",
                date: "Dec 15, 2025",
                tags: ["水处理"],
                cover: "", 
                desc: "基于《双膜培训交流》文档的全方位技术整理，涵盖预处理到反渗透的工艺细节、设备参数、运行逻辑及红线警示。",
                content: `
                    <h1>双膜法（UF+RO）水处理系统全流程技术手册</h1>
                    <div class="meta">Published on Dec 15, 2025</div>
                    
                    <p><strong>整理时间：</strong> 2025年12月15日<br>
                    <strong>资料来源：</strong> 双膜培训交流.pdf</p>
                    <hr>
                    
                    <p>这份整理涵盖了从预处理到反渗透的所有工艺细节、设备参数、运行逻辑及红线警示，<strong>修正了原文档中的笔误</strong>，并补充了具体的故障排查逻辑。您可以直接将其打印出来作为班组的技术培训资料或操作规程（SOP）的底稿。</p>

                    <h2>第一部分：预处理系统 (Pre-treatment)</h2>
                    <p>预处理是膜系统的“防弹衣”，主要目的是去除水中的悬浮物、胶体和大颗粒杂质，防止堵塞后续的精密膜元件。</p>

                    <h3>1. 多介质过滤器 (Multimedia Filter, MMF)</h3>
                    <ul>
                        <li><strong>设备概况：</strong> 本工程共设置4台多介质过滤器（规格 φ3.2*5.4m），运行模式为 <strong>3用1备</strong>。</li>
                        <li><strong>滤料级配：</strong> 采用双层滤料结构，利用深度过滤原理。
                            <ul>
                                <li><strong>顶层：</strong> 活性炭（最轻、最粗），用于截留较大的颗粒。</li>
                                <li><strong>底层：</strong> 石英砂（最重、最细），用于截留细小悬浮物。</li>
                            </ul>
                        </li>
                        <li><strong>出水水质标准：</strong>
                            <ul>
                                <li><strong>浊度：</strong> 必须 <strong>&lt; 3 NTU</strong>（注：原文档第21页误写为31，请严格按照第52页的运行注意事项执行）。</li>
                                <li><strong>悬浮物：</strong> &lt; 5 mg/L。</li>
                                <li><strong>COD：</strong> &lt; 40 mg/L。</li>
                                <li><strong>SDI：</strong> &lt; 5 (尽量控制在3以内)。</li>
                            </ul>
                        </li>
                        <li><strong>反洗要求：</strong> 多介质过滤器的反洗水压需 <strong>&gt; 0.2 MPa</strong>，否则无法把滤料冲开，达不到清洗效果。</li>
                    </ul>

                    <h3>2. 篮式过滤器 (Basket Strainer)</h3>
                    <ul>
                        <li><strong>作用：</strong> 位于多介质过滤器之后，作为一道物理屏障，拦截可能泄漏的滤料或大颗粒杂质，保护后续设备。</li>
                        <li><strong>结构：</strong> 主要由接管、主管、滤篮、法兰及盲板组成。杂质被阻挡在滤篮内。</li>
                        <li><strong>维护操作：</strong> 需定期旋开主管底部的螺塞进行排污，并拆卸法兰盖取出滤篮进行人工清洗。</li>
                    </ul>

                    <h2>第二部分：超滤系统 (Ultrafiltration, UF)</h2>
                    <p>超滤主要用于去除细菌、病毒、胶体及微小颗粒，为RO系统提供合格的进水。</p>

                    <h3>1. 核心设备参数</h3>
                    <ul>
                        <li><strong>膜元件型号：</strong> 陶氏 (DOW) <strong>SFP-2880</strong>。</li>
                        <li><strong>膜材质与结构：</strong> PVDF（聚偏氟乙烯），中空纤维，<strong>外压式</strong>（水从膜丝外部进入，净水从中心管流出）。</li>
                        <li><strong>过滤精度：</strong> <strong>0.03 μm</strong>（截留分子量120,000道尔顿），能有效去除细菌、胶体，但不能去除溶解性盐分。</li>
                        <li><strong>设计通量：</strong> 8000 L/H。</li>
                        <li><strong>操作压力：</strong> 标准操作压力 0.35 MPa。</li>
                        <li><strong>运行模式：</strong> 支持错流过滤（适合高浊度水）和死端过滤（适合低浊度水）。</li>
                    </ul>

                    <h3>2. 自动化运行程序 (Sequence)</h3>
                    <p>超滤系统通过PLC控制，按以下步骤交替循环运行：</p>
                    <ol>
                        <li><strong>过滤产水 (Production)：</strong> 运行时间 <strong>28-29 分钟</strong>。</li>
                        <li><strong>气擦洗 + 反洗 (Air Scour + Backwash)：</strong>
                            <ul>
                                <li>时长：<strong>&gt; 30秒</strong>。</li>
                                <li>气擦洗流量：<strong>5 Nm³/hr</strong>（气压 200kPa）。</li>
                                <li>反洗水流量：设计产水流速的 <strong>1.0 ~ 1.5 倍</strong>。</li>
                            </ul>
                        </li>
                        <li><strong>正冲洗 (Flush)：</strong>
                            <ul>
                                <li>时长：<strong>30秒</strong>。</li>
                                <li>流量：<strong>6 m³/hr</strong>。</li>
                            </ul>
                        </li>
                        <li><strong>化学加强反洗 (CEB)：</strong> 每运行 <strong>10-15 个周期</strong>，会自动加入药剂进行一次加强反洗，以防止生物膜和顽固污垢积累。</li>
                    </ol>

                    <h3>3. UF系统操作禁忌与红线</h3>
                    <ul>
                        <li><strong>压力限制：</strong> 进水母管压力需控制在 <strong>0.3 MPa 以内</strong>。原因：压力过高会导致次氯酸钠加药泵出口的安全阀起跳。</li>
                        <li><strong>温度限制：</strong> 最佳工作温度 <strong>35℃</strong>，切记不可超温运行，以免损坏膜材质。</li>
                        <li><strong>清洗红线：</strong> 当跨膜压差（TMP）<strong>&gt; 150 KPa (0.15 MPa)</strong> 时，必须停机进行离线化学清洗（CIP）。</li>
                        <li><strong>反洗避让：</strong> 严禁两套UF系统同时进入反洗程序，否则会导致共用的反洗水泵流量不足，洗不干净。</li>
                        <li><strong>操作防冲击：</strong> 手动操作阀门时要慢，避免“水锤”现象击碎膜丝。</li>
                    </ul>

                    <h2>第三部分：保安过滤器 (Cartridge Filter)</h2>
                    <p>这是反渗透高压泵前的最后一道防线。</p>
                    <ul>
                        <li><strong>滤芯规格：</strong> 5 μm 精度，PP（聚丙烯）材质，大流量折叠式，长度 40英寸 (1016mm)。</li>
                        <li><strong>更换标准：</strong>
                            <ul>
                                <li>正常运行压差：≤ 0.01 MPa。</li>
                                <li><strong>强制更换压差：0.03 MPa</strong>。一旦达到此值，滤芯会在几小时内迅速堵死，影响生产，必须立即更换。</li>
                            </ul>
                        </li>
                        <li><strong>更换技巧：</strong> 新滤芯安装前，建议将保安过滤器灌满水，加入 <strong>10ppm 次氯酸钠</strong> 浸泡30分钟，再冲洗干净使用，以去除滤芯可能携带的污染物。</li>
                    </ul>

                    <h2>第四部分：反渗透系统 (Reverse Osmosis, RO)</h2>
                    <p>RO系统是脱盐的核心单元，能去除溶解性盐分、有机物和微生物。</p>

                    <h3>1. 核心设备参数</h3>
                    <ul>
                        <li><strong>膜元件型号：</strong> 陶氏 (DOW) <strong>BW30FR-400/34i</strong>。</li>
                        <li><strong>膜特性：</strong> 聚酰胺复合膜，抗污染型（FR = Fouling Resistant）。</li>
                        <li><strong>有效面积：</strong> 400 ft² (37 m²)。</li>
                        <li><strong>脱盐率：</strong> 稳定脱盐率 99.5%，最低 99.0%。</li>
                        <li><strong>pH耐受范围：</strong> 连续运行 2-11，短时清洗（30分钟）1-13。</li>
                    </ul>

                    <h3>2. 进水水质严格要求 (RO膜的“生死线”)</h3>
                    <ul>
                        <li><strong>SDI15 (淤泥密度指数)：</strong> 必须 <strong>&lt; 3</strong> (最大容忍值为5)。如果SDI超标，必须检查预处理（多介质和UF）。</li>
                        <li><strong>余氯：</strong> 必须为 <strong>0 mg/L</strong>。RO膜对氯极其敏感，进水前必须还原掉所有余氯，否则膜会被氧化降解。</li>
                        <li><strong>水温：</strong> 控制在 <strong>5 - 35℃</strong>。</li>
                        <li><strong>pH值：</strong> 一般控制在 6-9。</li>
                    </ul>

                    <h3>3. 运行控制参数</h3>
                    <ul>
                        <li><strong>系统回收率：</strong> 设计值为 <strong>75%</strong>，严禁随意调整，否则会导致浓水侧结垢。</li>
                        <li><strong>最小流量限制：</strong> 系统运行流量不能低于 <strong>40 T/H</strong>，流量过低会导致流速不够，加剧膜表面结垢。</li>
                        <li><strong>压差监控：</strong>
                            <ul>
                                <li>一段、二段的段间压差最大不得超过 <strong>300 KPa (0.3 MPa)</strong>。</li>
                                <li>当压差达到 <strong>150 KPa (0.15 MPa)</strong> 时，建议立即安排化学清洗。</li>
                            </ul>
                        </li>
                    </ul>

                    <h2>第五部分：化学加药系统 (Chemical Dosing)</h2>
                    <p>系统共投加4种药剂，每种药剂的投加点和控制目标必须精确。</p>

                    <h3>1. 次氯酸钠 (NaClO) - 杀菌剂</h3>
                    <ul>
                        <li><strong>投加点1 (UF进水)：</strong> 加入超滤进水母管。
                            <ul><li><strong>目标：</strong> 控制超滤产水余氯 <strong>0.3 - 0.5 ppm</strong>。用于杀灭水中的细菌，防止细菌在后续管路滋生。</li></ul>
                        </li>
                        <li><strong>投加点2 (UF反洗)：</strong> 加入超滤反洗水母管。
                            <ul><li><strong>目标：</strong> 控制反洗排水余氯 <strong>5 - 10 ppm</strong>。用于化学加强反洗，剥离膜表面的有机污染物。</li></ul>
                        </li>
                    </ul>

                    <h3>2. 盐酸 (HCl) - 酸洗剂</h3>
                    <ul>
                        <li><strong>投加点：</strong> 超滤反洗水母管。
                            <ul><li><strong>目标：</strong> 控制反洗排水盐酸浓度 <strong>300 - 400 ppm</strong>。用于去除膜表面的无机垢（如碳酸钙）。</li></ul>
                        </li>
                    </ul>

                    <h3>3. 亚硫酸氢钠 (NaHSO3) - 还原剂</h3>
                    <ul>
                        <li><strong>投加点：</strong> 反渗透 (RO) 给水母管。</li>
                        <li><strong>目标：</strong> 投加量 <strong>3 - 5 ppm</strong>。</li>
                        <li><strong>作用：</strong> 作为还原剂，中和水中残留的余氯。必须确保RO进水余氯检测为 <strong>0</strong>。</li>
                    </ul>

                    <h3>4. 阻垢剂 (Antiscalant)</h3>
                    <ul>
                        <li><strong>投加点：</strong> 反渗透 (RO) 给水母管。</li>
                        <li><strong>目标：</strong> 投加量 <strong>3 - 5 ppm</strong>。</li>
                        <li><strong>作用：</strong> 络合钙镁离子，防止在RO浓水侧结垢。</li>
                    </ul>
                    <p><strong>计量泵维护：</strong> 每6个月检查泵头隔膜，每12个月更换传动油脂。</p>

                    <h2>第六部分：故障诊断与安全警示</h2>

                    <h3>1. 常见故障排查表 (RO系统)</h3>
                    <table border="1" cellspacing="0" cellpadding="5" style="border-collapse: collapse; width: 100%; margin-bottom: 20px;">
                        <thead>
                            <tr style="background-color: #f8f8f8;">
                                <th>故障现象 (压降/产水/脱盐率)</th>
                                <th>可能原因</th>
                                <th>发生位置</th>
                                <th>特征描述</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>压降↑ / 产水↓ / 盐透↑</strong></td>
                                <td><strong>结垢</strong> (如CaCO3)</td>
                                <td><strong>最后一段</strong></td>
                                <td>浓水端浓度最高，最易结垢。</td>
                            </tr>
                            <tr>
                                <td><strong>压降↑ / 产水↓ / 盐透↔</strong></td>
                                <td><strong>胶体/金属氧化物污染</strong></td>
                                <td><strong>第一段</strong></td>
                                <td>进水端最先被堵塞。</td>
                            </tr>
                            <tr>
                                <td><strong>压降↑ / 产水↓ / 盐透↔</strong></td>
                                <td><strong>生物污染</strong></td>
                                <td>任意段</td>
                                <td>细菌滋生，甚至可能导致压降正常。</td>
                            </tr>
                            <tr>
                                <td><strong>压降↔ / 产水↑ / 盐透↑</strong></td>
                                <td><strong>氧化 (余氯攻击)</strong></td>
                                <td>所有段</td>
                                <td>膜被氧化降解，变“稀疏”了，水和盐都容易通过。</td>
                            </tr>
                            <tr>
                                <td><strong>压降↓ / 产水↑ / 盐透↑</strong></td>
                                <td><strong>机械泄漏</strong></td>
                                <td>随机</td>
                                <td>O型圈泄漏、中心管破裂、防爆膜破裂。</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>2. 关键安全警示 (红线)</h3>
                    <ol>
                        <li><strong>严禁乱动浓水阀：</strong> 两套RO系统的浓水手动调节阀在调试完成后，<strong>严禁再次调节</strong>！建议锁死或把手轮拆下来。乱动会导致回收率失衡，造成严重结垢或膜损坏。</li>
                        <li><strong>防爆膜检查：</strong> 如果发现RO产水流量突然变为0，但其他压力数据正常，极可能是淡水侧的<strong>防爆膜启爆</strong>（破裂），需就地检查并更换。</li>
                        <li><strong>停机冲洗：</strong> 无论是UF还是RO，停机时都必须把系统内的浓水和药剂冲洗干净，防止长时间停机导致结垢或腐蚀。</li>
                    </ol>

                    <hr>
                    <h3>附录：SDI计算公式</h3>
                    <p>SDI (淤泥密度指数) = <code>(1 - T0 / T15) × 100 / 15</code></p>
                    <ul>
                        <li>T0：初始接500ml水所需的时间（秒）。</li>
                        <li>T15：在0.207MPa压力下过滤15分钟后，再接500ml水所需的时间（秒）。</li>
                    </ul>
                `
            },
            {
                id: "post-12",
                title:"超滤离线清洗步骤",
                date: "Dec 15, 2025",
                tags: ["水处理"],
                cover: "", 
                desc: "25年12月15日，工艺培训记录...",
                content: `
                    <h1>超滤清洗步骤</h1>
                    <div class="meta">Published on Dec 15, 2025</div>
                    <h2>一、清洗步骤</h2>
                    <p>杀菌—碱洗-冲洗-酸洗-冲洗</p>
                    <h2>二、清洗液配置</h2>
                    <p>配药：清洗罐共5m3，配水至4m3，方便循环。</p>
                    <p>杀菌：4方水大约配6kg氧化杀菌剂（次氯酸钠）</p>
                    <p>碱洗：4方水大约配6瓶碱液（PH=12）</p>
                    <p>酸洗：4方水大约配5瓶酸液。（PH=2）</p>
                    <h2>三、清洗时间</h2>
                    <p>1、碱洗：次氯酸钠+碱液，运行2小时（加温至35℃左右），浸泡2小时，在循环30分钟。（PH=12，期间检测PH，如降低投加碱液。）</p>
                    <p>2、冲洗至中性。（PH=7，检测PH）</p>
                    <p>3、酸洗：盐酸，温度控制30℃，运行1小时，浸泡1小时，在循环30分钟。（PH=2，期间检测PH，如升高投加盐酸。）</p>
                    <p>4、冲洗至中性。（PH=7，检测PH）</p>
                    <h2>四、清洗PH与压力</h2>
                    <p>（1）PH：碱洗12以上，酸洗2以下。</p>
                    <p>（2）压力：清洗进水压力控制在0.2mpa～0.3mpa（化学清洗保安过滤器上压力表）</p>
                    <h2>五、冲洗</h2>
                    <p>（1）每个清洗工序后都需要冲洗。</p>
                    <p>（2）冲洗时用清洗罐中的水，开启排放阀。碱洗、酸洗测PH，冲洗到中性。</p>
                    <blockquote>重点：清洗前再次确认，清洗进水阀、清洗浓水阀、清洗产水阀，水路通畅是开路状态。</blockquote>
                    `
            },
            {
                id: "post-11",
                title: "网站更新日志 v2.3：修复几个体验问题",
                date: "Dec 15, 2025",
                tags: ["Devlog", "Bugfix"],
                cover: "", 
                desc: "刚刚上线发现手机端有点问题，还有几个交互逻辑不太顺手，紧急修复了一下...",
                content: `
                    <h1>网站更新日志 v2.3</h1>
                    <div class="meta">Published on Dec 15, 2025</div>
                    
                    <p>一天的体验时间，拿手机一看，发现几个明显的问题。虽然不影响功能，但在体验上还是有点别扭，趁热打铁修了一下。</p>

                    <h2>1. 手机端显示调整</h2>
                    <p>之前在电脑上看着挺好，但在手机上，开屏动画结束后的留白太大了，感觉名片和上面的字离得十万八千里。我把手机端的顶部间距改小了，现在看起来紧凑多了。</p>

                    <h2>2. 修复遮挡 Bug</h2>
                    <p>在看文章的时候发现，往上滑屏幕，文章里的小标题居然盖住了顶部的“返回首页”按钮。调整了一下代码里的层级关系（z-index），现在导航栏会稳稳地压在所有内容上面。</p>

                    <h2>3. 搜索更好用了</h2>
                    <p>改了一下搜索逻辑。现在如果你先点了 "Code" 标签，再搜索关键词，它只会在代码分类里找，不会把其他不相关的文章翻出来，找东西更准了。</p>

                    <h2>4. 背景字加深</h2>
                    <p>感觉背景里的“无限进步”水印有点太淡了，如果不仔细看都发现不了。稍微调深了一点点颜色，现在一眼能看清，但又不抢眼。</p>

                    <p>折腾半天，总算看着舒服了。</p>
                `
            },
            {
                id: "post-10",
                title: "网站架构更新日志 v2.2：禅意与负熵",
                date: "Dec 14, 2025",
                tags: ["Devlog", "Design"],
                cover: "", 
                desc: "删繁就简，直面本质。在 v2.2 版本中，我移除了所有冗余的图片装饰，用纯粹的文字动效构建了全新的视觉语言...",
                content: `
                    <h1>网站架构更新日志 v2.2</h1>
                    <div class="meta">Published on Dec 14, 2025</div>
                    <p>这是本站建立以来跨度最大的一次视觉重构。我放弃了流行的“磨砂玻璃”与“流体渐变”，选择了一条更难的路——<b>“禅意极简” (Zen Minimalism)</b>。</p>
                    <h2>1. 视觉重构</h2>
                    <p>我删除了首页的 Banner 图片。现在，屏幕中央只有“无限进步”四个大字。它们既是背景水印，也是我的精神图腾。</p>
                    <h2>2. 交互核心</h2>
                    <p>为了让极简不显简陋，我对开屏动画进行了物理级的调优：开屏的黑色实心字不再向上飞行，而是直接在最终位置出现，精准地“溶解”为背景的淡灰色水印。</p>
                    <h2>3. 逻辑修正</h2>
                    <p>修复了文章排序系统的核心 Bug。引入了时间戳比对逻辑，确保无论数据录入顺序如何，最新的思考永远置顶。</p>
                    <blockquote>"轮回非循环，乃螺旋；直面熵增，创生负熵。"</blockquote>
                `
            },
            {
                id: "post-9",
                title: "网站架构更新日志 v2.1：体验进化",
                date: "Dec 14, 2025",
                tags: ["Devlog"],
                cover: "", 
                desc: "在 v2.0 数据驱动架构的基础上，进一步完善了核心检索与分类系统，并实装了路由支持...",
                content: `
                    <h1>网站架构更新日志 v2.1</h1>
                    <div class="meta">Published on Dec 14, 2025</div>
                    <p>距离 v2.0 重构仅仅两天，我对网站的交互体验进行了密集的迭代。本次 v2.1 更新主要致力于让信息获取变得更加“顺滑”与“优雅”。</p>
                    <h2>1. 交互升级：收纳式标签 (Tag Storage)</h2>
                    <p>为了在增加分类功能的同时保持极简设计，我引入了<b>“收纳式交互”</b>逻辑。</p>
                    <h2>2. 检索内核：全文高亮 (Deep Search)</h2>
                    <p>搜索体验得到了质的飞跃。不再局限于标题匹配，系统现在支持<b>全文检索</b>。</p>
                    <h2>3. 路由系统 (Routing)</h2>
                    <p>补全了单页应用 (SPA) 的最后一块拼图。现在，无论是点击文章还是筛选标签，浏览器地址栏都会同步更新（如 <code>?post=id</code>）。</p>
                    <blockquote>"Iteration is the key to perfection." <br>(迭代是通往完美的钥匙。)</blockquote>
                `
            },
            {
                id: "post-8",
                title: "HTML 特殊符号速查表 (详解版)",
                date: "Dec 14, 2025",
                tags: ["Code", "HTML"],
                cover: "", 
                desc: "为什么键盘上的符号不能直接用？整理了最常用的 HTML 字符实体与原理解析...",
                content: `
                    <h1>HTML 特殊符号速查表 (详解版)</h1>
                    <div class="meta">Published on Dec 14, 2025</div>
                    <p>你是否遇到过这种情况：在代码里写了多个空格，网页上却只显示一个？或者写了“&lt;”符号，后面的文字突然全都不见了？</p>
                    <p>这是因为浏览器把某些符号当成了“指令”。为了显示这些符号本身，我们需要使用<b>字符实体 (HTML Entities)</b>，也就是符号的“替身”。</p>
                    <h2>1. 基础三巨头：防止代码崩溃</h2>
                    <p>这三个符号是 HTML 语法的基石，直接使用会导致浏览器解析错误，必须使用替身。</p>
                    <h3>🔵 &amp;lt; (小于号)</h3>
                    <ul><li><b>本尊</b>：<code>&lt;</code> (Less Than)</li><li><b>代码写法</b>：<code>&amp;lt;</code></li></ul>
                    <h3>🔵 &amp;gt; (大于号)</h3>
                    <ul><li><b>本尊</b>：<code>&gt;</code> (Greater Than)</li><li><b>代码写法</b>：<code>&amp;gt;</code></li></ul>
                    <h3>🔵 &amp;amp; (和号)</h3>
                    <ul><li><b>本尊</b>：<code>&amp;</code> (Ampersand)</li><li><b>代码写法</b>：<code>&amp;amp;</code></li></ul>
                    <h2>2. 排版神器</h2>
                    <h3>🔵 &amp;nbsp; (不换行空格)</h3>
                    <ul><li><b>代码写法</b>：<code>&amp;nbsp;</code></li><li><b>用途</b>：强制空格，防止自动换行。</li></ul>
                    <h2>3. 代码安全</h2>
                    <h3>🔵 &amp;quot; (双引号)</h3>
                    <ul><li><b>代码写法</b>：<code>&amp;quot;</code></li></ul>
                `
            },
            {
                /* ✨✨✨ Post-7 完整修复版 (8个技巧) ✨✨✨ */
                id: "post-7",
                title: "新手小白必会的 HTML 标签清单",
                date: "Dec 14, 2025",
                tags: ["Code", "HTML"],
                cover: "", 
                desc: "作为新手小白，“生存级”标签...",
                content: `
                    <h1>新手小白必会的 HTML 标签清单</h1>
                    <div class="meta">Published on Dec 14, 2025</div>
                    <p>本帖持续更新</p>
                    
                    <h2>1. 标题家族：&lt;h1&gt; 到 &lt;h6&gt;</h2>
                    <p>用来区分文章的层级，就像报纸的排版。<code>h1</code> 最大（通常是文章标题，一个页面最好只用一个），<code>h6</code> 最小。</p>
                    
                    <h2>2. 正文段落：&lt;p&gt;</h2>
                    <p>Paragraph 的缩写。绝大多数的普通文字都要放在这里面，浏览器会自动在段落之间留出空隙。</p>
                    
                    <h2>3. 图片：&lt;img&gt;</h2>
                    <p><b>核心写法</b>：<code>&lt;img src="图片链接"&gt;</code>。注意，它不需要结束标签。</p>
                    
                    <h2>4. 链接：&lt;a&gt;</h2>
                    <p>Anchor 的缩写。<b>核心写法</b>：<code>&lt;a href="网址"&gt;点击这里的文字&lt;/a&gt;</code>。它是互联网之所以互联的核心。</p>
                    
                    <h2>5. 万能盒子：&lt;div&gt;</h2>
                    <p>Division 的缩写。它本身没有任何特殊样子，就是一个空的“盒子”。它是网页布局的核心，用来把其他元素打包在一起，方便排版。</p>
                    
                    <h2>6. 强制换行：&lt;br&gt;</h2>
                    <p>Break 的缩写。如果你想在段落内部强行换一行，就用它。和 <code>img</code> 一样，它也不需要结束标签。</p>
                    
                    <h2>7. 列表：&lt;ul&gt; 和 &lt;li&gt;</h2>
                    <p>用来创建无序列表（Unordered List）。<code>ul</code> 是外面的框，<code>li</code> 是里面的每一项。你现在看到的这个清单就是用它写的。</p>
                    
                    <h2>8. 行内微调：&lt;span&gt;</h2>
                    <p>如果说 <code>div</code> 是大盒子，<code>span</code> 就是小袋子。它通常用来包裹一行文字中的<b>某几个字</b>，方便给这几个字单独加颜色或加粗。</p>
                    
                    <h2>9. 黑体: &lt;b&gt; 和 &lt;/b&gt;
                    <p><b>像这样</b><p>
                    <blockquote>总结：代码是给人看的，顺便给机器执行。用对标签，保持整洁！</blockquote>
                `
            },
            {
                id: "post-5",
                title: "如何利用AI制作个人网站",
                date: "Dec 12, 2025",
                tags: ["AI", "Code", "Thinking"],
                cover: "", 
                desc: "不需会很很多操作，只需有想法有灵感，用好AI工具...",
                content: `
                    <h1>用AI制作个人网站</h1>
                    <div class="meta">Published on Dec 12, 2025</div>
                    <p>我制作网站这个念头，源于刷短视频提供的灵感。我惊叹 AI 已经进化到这种地步了，作为一个化工行业的普通工人，我决定自己来尝试一下。</p>
                    <h2>整理自我期望</h2>
                    <p>把网站的用途、功能、风格想好。我想要一个极简的、白色的、没有多余广告的角落，用来放我的摄影作品和日常思考。然后，我把这些想法直接告诉 AI。</p>
                    <h2>在实践中学习</h2>
                    <p>回想自己从前使用工具的逻辑：比如说我想使用 PS 修图，我得先下软件，再从 Bilibili 找一个入门教程，系统性地学完入门篇，然后再去尝试使用 PS。是“先学再用”的逻辑。</p>
                    <p>但是随着年龄增加，不再是有闲工夫的学生了，业余时间和精力也大大降低。外加我对编程入门颇感困难，我暂时不考虑系统性学习编程了。</p>
                    <p>现在做的就是<b>“边干边学” (Learning by doing)</b>。AI 生成代码后，它会告诉我怎么样把这个网站上传到 GitHub。说起来简单，期间也是困难重重。我照着 AI 的教程不一定做对，一旦遇到问题，我就截图反馈给 AI。有时候 AI 的描述我实在读不懂，那我就再简单上网查一下，或者问问我身边的程序员朋友——这算是我的“杀手锏”了，哈哈😂。</p>
                    <h2>AI 的调教技巧</h2>
                    <p>AI 有时候会偷懒。问题往往在于提问方式。对待 AI 尽量要少用“你”这个字眼，它是冰冷的工具，过度拟人化有时候反而效率低。</p>
                    <p>比如：
                    <br>❌ 提示词：请你帮我创作一个个人网站...
                    <br>✅ 提示词：<b>你是一位世界顶级的网页设计大师，请用极简主义风格重构以下代码...</b></p>
                    <p>换个问法，AI 就会瞬间变身，给出完全不同维度的代码。</p>
                    <blockquote>这个网站的所有代码，包括你现在看到的这篇文章，都是我和 AI 共同协作的成果。</blockquote>
                `
            },
            {
                id: "post-4",
                title: "网站架构更新日志 v2.0",
                date: "Dec 12, 2025",
                tags: ["Devlog"],
                cover: "images/251212.jpg", 
                desc: "添加小小的想法，网站变得越来越像那么回事了",
                content: `
                    <h1>网站架构升级日志 v2.0</h1>
                    <div class="meta">Published on Dec 12, 2025</div>
                    <p>为了追求极致的性能与极简的维护体验，我对个人网站的底层架构进行了“降维打击”式的重构。</p>
                    <h2>1. 架构重构：数据驱动 (Data-Driven)</h2>
                    <p>放弃了传统的 HTML 硬编码模式，构建了基于 JSON 的数据层。现在，视图（View）与数据（Data）完全分离，新增文章只需配置数据，渲染引擎会自动生成精美的卡片。</p>
                    <h2>2. 性能优化：懒加载 (Lazy Loading)</h2>
                    <p>引入了 <code>loading="lazy"</code> 机制。图片资源按需加载，大幅降低了首屏网络请求，让移动端浏览体验如丝般顺滑。</p>
                    <h2>3. 视觉系统：全局变量 (CSS Variables)</h2>
                    <p>使用 CSS 变量构建了原子化的设计系统。将“克莱因蓝”与“留白”定义为全局参数，确保了全站视觉语言的高度统一与可扩展性。</p>
                    <h2>4. 逻辑增强：自动化 (Automation)</h2>
                    <p>重写了 JavaScript 逻辑内核，实现了基于时间戳的<b>自动排序</b>与毫秒级的<b>全文检索</b>功能。让机器去处理逻辑，让人专注于创作。</p>
                    <blockquote> "Code is poetry, and simplicity is the ultimate sophistication." <br> —— 代码即诗，极简即是终极的高级。</blockquote>
                `
            },           
            {
                id: "post-2",
                title: "如何用 VS Code 搭建个人博客",
                date: "Dec 10, 2025",
                tags: ["Code"],
                cover: "", 
                desc: "不需要复杂的服务器，只需要一个 GitHub 账号和 VS Code，你就能拥有属于自己的角落...",
                content: `
                    <h1>如何用 VS Code 搭建个人博客</h1>
                    <div class="meta">Published on Dec 10, 2025</div>
                    <p>很多人觉得写代码很难，其实搭建一个最基础的静态博客只需要三步。这是我作为新手小白的实践总结。</p>
                    <h2>第一步：准备工作</h2>
                    <ul>
                        <li>下载并安装 <b>VS Code</b> (Visual Studio Code)。</li>
                        <li>注册一个 <b>GitHub</b> 账号。</li>
                        <li>安装 VS Code 插件：<b>Live Server</b>（它可以让你实时预览网页）。</li>
                    </ul>
                    <h2>第二步：编写 HTML</h2>
                    <p>新建一个 <code>index.html</code> 文件，输入 <code>!</code> 然后按 Tab 键，VS Code 会自动帮你生成基础骨架。使用语义化的标签，让网页结构清晰。</p>
                    <h2>第三步：上传 GitHub</h2>
                    <p>创建一个名为 <code>yourname.github.io</code> 的仓库，把代码上传上去。几分钟后，你就可以通过这个网址访问你的网站了。</p>
                    <p>这就是你现在看到的这个网站的雏形。</p>
                `
            },
            {
                id: "post-1",
                title: "为什么我选择了极简主义",
                date: "Dec 11, 2025",
                tags: ["Life", "Thinking"],
                cover: "images/photo1.jpg",
                desc: "蓝色是天空的深度，也是大海的静谧。在设计这个网站时，我刻意去掉了多余的边框和装饰...",
                content: `
                    <h1>为什么我选择了极简主义</h1>
                    <div class="meta">Published on Dec 11, 2025</div>
                    <p>我是一名化工厂污水处理工人。我的日常工作是面对复杂的管道、浑浊的液体和各种繁琐的数据指标。</p>
                    <p>这也许就是为什么在生活中，我极度渴望<b>纯净</b>与<b>秩序</b>。</p>
                    <h2>Blue / Photography / Minimalist</h2>
                    <p><b>蓝色</b>是天空的深度，也是大海的静谧。它代表着冷静与逻辑。</p>
                    <p><b>摄影</b>是减法的艺术。在取景器里，我必须排除干扰，只保留主体。这和我做这个网站的初衷一样——去除多余的边框、复杂的背景，只保留内容本身。</p>
                    <p>在这个信息过载的时代，我想在这个小小的角落里，对抗“熵增”，创造一点点属于自己的“负熵”。</p>
                    <p>这就是我，Polo Aoi。</p>
                `
            }
        ];
        

        const container = document.getElementById('posts-container');
        const tagPanel = document.getElementById('tagPanel');
        const tagGrid = document.getElementById('tagGrid');
        const filterBtn = document.getElementById('filterBtn');
        const filterBtnText = document.getElementById('filterBtnText');
        
        let currentTag = 'All'; 
        let isPanelOpen = false;

        function init() {
            // 排序逻辑
            blogData.sort((a, b) => {
                const timeA = new Date(a.date).getTime();
                const timeB = new Date(b.date).getTime();
                const diff = timeB - timeA;
                return diff !== 0 ? diff : 0;
            });

            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('post');
            const tagParam = urlParams.get('tag');

            renderTagMenu();

            if (tagParam) {
                filterByTag(tagParam, false);
            } else {
                renderPosts(blogData);
            }

            if (postId) openArticle(postId);
        }

        function toggleTagPanel() {
            isPanelOpen = !isPanelOpen;
            tagPanel.style.display = isPanelOpen ? 'block' : 'none';
            if(isPanelOpen) {
                filterBtn.style.borderColor = 'var(--primary)';
            } else {
                if(currentTag === 'All') filterBtn.style.borderColor = 'var(--line-color)';
            }
        }

        function renderTagMenu() {
            const allTags = new Set();
            blogData.forEach(post => {
                if(post.tags) post.tags.forEach(t => allTags.add(t));
            });
            const tagsArray = ['All', ...Array.from(allTags)];
            tagGrid.innerHTML = tagsArray.map(tag => `
                <button class="tag-option ${tag === currentTag ? 'selected' : ''}" onclick="selectTag('${tag}')">${tag}</button>
            `).join('');
        }

        function selectTag(tag) {
            toggleTagPanel();
            filterByTag(tag, true);
        }

        function filterByTag(tag, updateUrl = true) {
            currentTag = tag;
            filterBtnText.innerText = tag === 'All' ? 'Tags' : tag;
            if (tag !== 'All') filterBtn.classList.add('active');
            else filterBtn.classList.remove('active');

            const options = document.getElementsByClassName('tag-option');
            Array.from(options).forEach(opt => {
                if(opt.innerText === tag) opt.classList.add('selected');
                else opt.classList.remove('selected');
            });

            if (updateUrl) {
                const newUrl = tag === 'All' ? window.location.pathname : '?tag=' + tag;
                window.history.pushState({ tag: tag }, '', newUrl);
            }

            // ⚡️ 修复3：调用统一的筛选函数，而不是简单的 renderPosts
            filterPostsCombined();
        }

        // ⚡️ 修复3：将搜索逻辑和标签逻辑合并，防止冲突
        function filterPostsCombined() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            
            let filtered = blogData;

            // 1. 先筛选标签
            if (currentTag !== 'All') {
                filtered = filtered.filter(post => post.tags && post.tags.includes(currentTag));
            }

            // 2. 再筛选搜索词
            if (query) {
                filtered = filtered.filter(post => {
                    const plainContent = stripHtml(post.content).toLowerCase();
                    return post.title.toLowerCase().includes(query) || 
                           post.date.toLowerCase().includes(query) || 
                           post.desc.toLowerCase().includes(query) ||
                           plainContent.includes(query);
                });
            }

            renderPosts(filtered, query);
        }

        function renderPosts(data, highlightKeyword = null) {
            container.innerHTML = "";
            if(data.length === 0) {
                container.innerHTML = `<div style="text-align:center; color:#999; margin-top:50px;">No matches found.</div>`;
                return;
            }

            data.forEach(post => {
                let displayDesc = post.desc;
                let imgHTML = '';
                let tagsHTML = '';
                
                if (post.tags) {
                    tagsHTML = post.tags.map(t => `<span class="card-tag">${t}</span>`).join('');
                }

                if (highlightKeyword) {
                    const plainText = stripHtml(post.content);
                    const snippet = getSmartSnippet(plainText, highlightKeyword);
                    if (snippet) displayDesc = snippet; 
                }

                if (post.cover && post.cover !== "") {
                    imgHTML = `<img src="${post.cover}" class="post-cover-thumb" loading="lazy" onerror="this.style.display='none'">`;
                }

                const cardHTML = `
                    <div class="post-card" onclick="onCardClick('${post.id}')">
                        <div class="card-header-row">
                            <span class="post-meta">${post.date}</span>
                            ${tagsHTML}
                        </div>
                        <h3 class="post-title">${post.title}</h3>
                        ${imgHTML}
                        <div class="post-excerpt">${displayDesc}</div>
                        <span class="read-more-btn">Read Article</span>
                    </div>
                `;
                container.innerHTML += cardHTML;
            });
        }

        function stripHtml(html) {
            let tmp = document.createElement("DIV");
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || "";
        }

        function getSmartSnippet(fullText, keyword) {
            const lowerText = fullText.toLowerCase();
            const lowerKey = keyword.toLowerCase();
            const index = lowerText.indexOf(lowerKey);
            if (index === -1) return null;
            const start = Math.max(0, index - 20);
            const end = Math.min(fullText.length, index + lowerKey.length + 50);
            let snippet = fullText.substring(start, end);
            if (start > 0) snippet = "..." + snippet;
            if (end < fullText.length) snippet = snippet + "...";
            const regex = new RegExp(`(${keyword})`, 'gi');
            return snippet.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function handleSearch() {
            // ⚡️ 修复3：输入时也调用合并筛选函数
            filterPostsCombined();
        }

        function onCardClick(id) {
            window.history.pushState({ postId: id }, '', '?post=' + id);
            openArticle(id);
        }

        function openArticle(id) {
            const post = blogData.find(p => p.id === id);
            if(post) {
                document.getElementById('reader-body').innerHTML = post.content;
                document.getElementById('article-reader').style.display = 'block';
                document.body.style.overflow = 'hidden';
                document.getElementById('article-reader').scrollTop = 0;
            }
        }

        function closeArticle() {
            window.history.pushState({}, '', window.location.pathname);
            document.getElementById('article-reader').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        window.onpopstate = function(event) {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('post');
            const tagParam = urlParams.get('tag');

            if (postId) openArticle(postId); 
            else if (tagParam) {
                document.getElementById('article-reader').style.display = 'none';
                filterByTag(tagParam, false);
            } else {
                document.getElementById('article-reader').style.display = 'none';
                document.body.style.overflow = 'auto';
                filterByTag('All', false);
            }
        };

        window.onload = init;
    </script>
</body>
</html>
